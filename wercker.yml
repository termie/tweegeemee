no-response-timeout: 60
command-timeout: 60

# Run this on a cronjob
gen-urls:
  box: python:2.7
  steps:
    - pip-install
    - script:
        code: |
          python gen_urls.py

# Run this for each new url
gen-code:
  box: python:2.7
  steps:
    - pip-install
    - script:
        code: |
          python gen_code.py $TGM_URL > src/tweegeemee/onetime.clj


# This chains from gen-code
gen-image:
  box: clojure
  steps:
    - script:
        code: |
          lein run -m tweegeemee.onetime/mymain
          ls -lah
          cp output.png $WERCKER_REPORT_ARTIFACTS_DIR/
          cp output.png $WERCKER_OUTPUT_DIR/$TGM_NAME

upload-image:
  box: alpine:3.2
  steps:
    - s3sync:
        delete-removed: false
        bucket-url: $AWS_BUCKET
        key-id: $AWS_ACCESS_KEY_ID
        key-secret: $AWS_SECRET_ACCESS_KEY
